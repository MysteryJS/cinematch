<!DOCTYPE html>
<html lang="el">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ποιος ηθοποιός μοιάζεις; — CineMatch</title>
    <link rel="stylesheet" href="face_detection.css">
</head>

<body>
    <nav class="navbar">
        <div class="nav-container">
            <a href="index.html" class="logo-link" title="CineMatch">
                <img src="/logo.png" alt="CineMatch logo" class="logo-img">
            </a>

            <ul class="nav-menu">
                <li><a href="/" data-page="home" class="nav-link">Home</a></li>
                <li><a href="/search" class="nav-link">Search</a></li>
                <li><a href="/trending" class="nav-link">Trending Movies</a></li>
                <li><a href="/quiz" class="nav-link">Quiz</a></li>
                <li><a href="/sentiment" class="nav-link">Sentiment Analysis</a></li>
                <li><a href="/face" class="nav-link active">Face Detection</a></li>
                <li><a href="/kpi" class="nav-link">KPIs</a></li>
            </ul>
        </div>
    </nav>

    <main class="page active">
        <div class="page-header">
            <h1>Βρες ποιος ηθοποιός μοιάζει με εσένα</h1>
            <p>Φόρτωσε μια φωτογραφία και θα σου δείξουμε τον πιο κοντινό ηθοποιό και άλλες προτάσεις.</p>
        </div>

        <section class="face-ui">
            <div class="upload-panel">
                <label class="dropzone" id="dropzone">
                    <input id="photoInput" type="file" accept="image/*" hidden>
                    <div class="dz-content">
                        <svg class="camera-icon" width="48" height="48" viewBox="0 0 24 24" fill="none"
                            aria-hidden="true">
                            <path
                                d="M20 7h-3.586l-1.707-1.707A.996.996 0 0014.586 5H9.414a.996.996 0 00-.707.293L7 7H4a2 2 0 00-2 2v8a2 2 0 002 2h16a2 2 0 002-2V9a2 2 0 00-2-2z"
                                stroke="currentColor" stroke-width="1.2" stroke-linecap="round"
                                stroke-linejoin="round" />
                            <circle cx="12" cy="13" r="3" stroke="currentColor" stroke-width="1.2"
                                stroke-linecap="round" stroke-linejoin="round" />
                        </svg>
                        <p>Κάνε κλικ ή σύρε μια φωτογραφία εδώ</p>
                        <small>Υποστηρίζονται JPG / PNG. Μέγιστο μέγεθος 8MB.</small>
                    </div>
                </label>

                <div class="preview-and-actions">
                    <div class="preview" id="preview">
                        <img id="previewImg" src="" alt="Προεπισκόπηση" hidden>
                        <div class="preview-empty">Δεν έχει φορτωθεί εικόνα</div>
                    </div>

                    <div class="actions">
                        <button id="chooseBtn" class="btn" type="button">Επίλεξε αρχείο</button>
                        <button id="sendBtn" class="btn primary" type="button" disabled>Ανάλυση &amp; Σύγκριση</button>
                        <button id="clearBtn" class="btn ghost" type="button" disabled>Καθαρισμός</button>
                    </div>
                </div>
            </div>

            <div class="results" id="results">
                <div class="results-empty">Εδώ θα εμφανιστούν τα αποτελέσματα της σύγκρισης.</div>
            </div>
        </section>
    </main>

    <footer class="site-footer" aria-label="Footer">
      <div class="footer-container">
        <!-- Column 1: Logo + short tagline -->
        <div class="footer-col footer-brand">
          <a href="/" class="logo-link" title="CineMatch">
            <img src="/logo.png" alt="CineMatch logo" class="logo-img footer-logo">
          </a>
          <p class="footer-tagline">Ανακάλυψε ταινίες με έξυπνες προτάσεις και μικρές περιγραφές.</p>
        </div>

        <div class="footer-col footer-nav">
          <h4 class="footer-title">Μενού</h4>
          <ul class="footer-menu">
            <li><a href="/" class="footer-link">Home</a></li>
            <li><a href="/search" class="footer-link">Search</a></li>
            <li><a href="/trending" class="footer-link">Trending Movies</a></li>
            <li><a href="/quiz" class="footer-link">Quiz</a></li>
            <li><a href="/sentiment" class="footer-link">Sentiment Analysis</a></li>
            <li><a href="/face" class="footer-link">Face Detection</a></li>
          </ul>
        </div>

        <div class="footer-col footer-social">
          <h4 class="footer-title">Ακολούθησέ μας</h4>
          <div class="social-links">
            <a href="https://facebook.com/" class="social-link" aria-label="Facebook" target="_blank" rel="noopener noreferrer">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M22 12.07C22 6.48 17.52 2 11.93 2S2 6.48 2 12.07c0 4.99 3.66 9.13 8.44 9.93v-7.03H7.9v-2.9h2.54V9.41c0-2.5 1.49-3.88 3.77-3.88 1.09 0 2.23.2 2.23.2v2.45h-1.25c-1.23 0-1.61.76-1.61 1.54v1.85h2.74l-.44 2.9h-2.3v7.03C18.34 21.2 22 17.06 22 12.07z" fill="currentColor"/></svg>
              <span>Facebook</span>
            </a>
            <a href="https://instagram.com/" class="social-link" aria-label="Instagram" target="_blank" rel="noopener noreferrer">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M7 2h10a5 5 0 0 1 5 5v10a5 5 0 0 1-5 5H7a5 5 0 0 1-5-5V7a5 5 0 0 1 5-5zm5 6.2A4.8 4.8 0 1 0 16.8 13 4.8 4.8 0 0 0 12 8.2zm6.5-3.7a1.1 1.1 0 1 0 1.1 1.1 1.1 1.1 0 0 0-1.1-1.1z" fill="currentColor"/></svg>
              <span>Instagram</span>
            </a>
            <a href="https://twitter.com/" class="social-link" aria-label="Twitter" target="_blank" rel="noopener noreferrer">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M22 5.92c-.66.29-1.37.48-2.11.57a3.66 3.66 0 0 0 1.6-2.02 7.18 7.18 0 0 1-2.33.9A3.59 3.59 0 0 0 12.2 8.6c0 .28.03.56.09.83A10.2 10.2 0 0 1 3 5.16a3.57 3.57 0 0 0 1.11 4.78 3.5 3.5 0 0 1-1.62-.45v.05a3.6 3.6 0 0 0 2.88 3.52c-.47.13-.97.2-1.48.2-.36 0-.72-.03-1.06-.1a3.6 3.6 0 0 0 3.36 2.5A7.22 7.22 0 0 1 2 19.54 10.21 10.21 0 0 0 7.2 21c6.24 0 9.66-5.18 9.66-9.67v-.44c.66-.48 1.22-1.08 1.67-1.76a10.12 10.12 0 0 1-2.51.68z" fill="currentColor"/></svg>
              <span>Twitter</span>
            </a>
          </div>
        </div>
      </div>

        <div class="footer-bottom">
            <div class="footer-container">
                <p class="small">&copy; <span id="year">2025</span> CineMatch — Όλα τα δικαιώματα διατηρούνται.</p>
                <p class="small muted">Σχεδιασμένο με ❤ για κινηματογραφόφιλους.</p>


                <a href="/TOU" class="footer-link" style="margin-top:10px; display:inline-block;">
                    Όροι Χρήσης
                </a>
            </div>
        </div>
    </footer>

    <script>
        const dropzone = document.getElementById('dropzone');
        const photoInput = document.getElementById('photoInput');
        const chooseBtn = document.getElementById('chooseBtn');
        const sendBtn = document.getElementById('sendBtn');
        const clearBtn = document.getElementById('clearBtn');
        const preview = document.getElementById('preview');
        const previewImg = document.getElementById('previewImg');
        const results = document.getElementById('results');

        let currentFile = null;

        ['dragenter', 'dragover'].forEach(evt => {
            dropzone.addEventListener(evt, (e) => {
                e.preventDefault();
                dropzone.classList.add('dz-over');
            });
        });
        ['dragleave', 'drop', 'dragend'].forEach(evt => {
            dropzone.addEventListener(evt, (e) => {
                e.preventDefault();
                dropzone.classList.remove('dz-over');
            });
        });

        dropzone.addEventListener('click', () => photoInput.click());
        dropzone.addEventListener('drop', (e) => {
            const dt = e.dataTransfer;
            if (dt && dt.files && dt.files[0]) handleFile(dt.files[0]);
        });

        photoInput.addEventListener('change', (e) => {
            if (e.target.files && e.target.files[0]) handleFile(e.target.files[0]);
        });

        chooseBtn.addEventListener('click', () => photoInput.click());
        clearBtn.addEventListener('click', clearSelection);

        sendBtn.addEventListener('click', () => {
            if (!currentFile) return;
            analyzePhoto(currentFile);
        });

        function handleFile(file) {
            const maxMB = 8;
            if (!file.type.startsWith('image/')) {
                showError('Παρακαλώ επίλεξε αρχείο εικόνας.');
                return;
            }
            if (file.size > maxMB * 1024 * 1024) {
                showError(`Το αρχείο είναι πολύ μεγάλο. Μέγιστο ${maxMB}MB.`);
                return;
            }

            currentFile = file;
            const url = URL.createObjectURL(file);
            previewImg.src = url;
            previewImg.hidden = false;
            preview.querySelector('.preview-empty').hidden = true;

            sendBtn.disabled = false;
            clearBtn.disabled = false;
            results.innerHTML = '<div class="results-empty">Ετοιμοί για ανάλυση. Πάτησε "Ανάλυση &amp; Σύγκριση".</div>';
        }

        function clearSelection() {
            currentFile = null;
            previewImg.src = '';
            previewImg.hidden = true;
            preview.querySelector('.preview-empty').hidden = false;
            sendBtn.disabled = true;
            clearBtn.disabled = true;
            results.innerHTML = '<div class="results-empty">Εδώ θα εμφανιστούν τα αποτελέσματα της σύγκρισης.</div>';
        }

        function showError(message) {
            results.innerHTML = `<div class="error">${escapeHtml(message)}</div>`;
        }

        function showLoading() {
            results.innerHTML = `<div class="loading">Ανάλυση εικόνας…</div>`;
        }

        function renderResults(data) {

            if (data.error) {
                results.innerHTML = `<div class="no-match">${escapeHtml(data.error)}</div>`;
                return;
            }

            let similarity = data.similarity;
            if (similarity === undefined && data.score !== undefined) {
                similarity = (1 - data.score) * 100;
            }

            if (similarity !== undefined && similarity < 45) {
                results.innerHTML = `<div class="no-match">Δεν βρέθηκε αρκετά κοντινό πρόσωπο (ομοιότητα μόνο ${Math.round(similarity)}%).</div>`;
                return;
            }

            if (data.closest_celebrity && data.score !== undefined) {
                results.innerHTML = `
            <div class="result-card">
                <h3>Αποτέλεσμα</h3>
                <p><strong>Ηθοποιός:</strong> ${escapeHtml(data.closest_celebrity)}</p>
                <p><strong>Ομοιότητα:</strong> ${Math.round(similarity)}%</p>
            </div>
        `;
                return;
            }
            results.innerHTML = `<div class="no-match">Δεν βρέθηκε αποτέλεσμα.</div>`;
        }

        async function analyzePhoto(file) {
            showLoading();
            const fd = new FormData();
            fd.append('photo', file, file.name);

            try {
                const res = await fetch('http://localhost:5001/match', {
                    method: 'POST',
                    body: fd
                });
                const json = await res.json();
                renderResults(json);
            } catch (err) {
                showError('Network error: ' + (err && err.message ? err.message : err));
            }
        }

        function escapeHtml(unsafe) {
            if (!unsafe && unsafe !== '') return '';
            return String(unsafe)
                .replace(/&/g, '&amp;')
                .replace(/</g, '&lt;')
                .replace(/>/g, '&gt;')
                .replace(/"/g, '&quot;')
                .replace(/'/g, '&#039;');
        }

        (function updateFooterYear() {
          const y = new Date().getFullYear();
          const el = document.getElementById('year');
          if (el) el.textContent = y;
        })();

    </script>
</body>

</html>
