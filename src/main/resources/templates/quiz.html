<!DOCTYPE html>
<html lang="el">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Quiz — CineMatch (Ταινίες)</title>
    <link rel="stylesheet" href="quiz.css" />
</head>
<body>
    <nav class="navbar" role="navigation" aria-label="Κύριο μενού">
        <div class="nav-container">
            <a href="index.html" class="logo-link" title="CineMatch">
                <img src="/logo.png" alt="CineMatch" class="logo-img">
            </a>
            <ul class="nav-menu" role="menubar">
                <li><a href="/" data-page="home" class="nav-link">Home</a></li>
                <li><a href="/search" class="nav-link">Search</a></li>
                <li><a href="/trending" class="nav-link">Trending Movies</a></li>
                <li><a href="/quiz" class="nav-link active">Quiz</a></li>
                <li><a href="/sentiment" class="nav-link">Sentiment Analysis</a></li>
                <li><a href="/face" class="nav-link">Face Detection</a></li>
                <li><a href="/login" class="nav-link">Login</a></li>
            </ul>
        </div>
    </nav>

    <main class="page" id="main">
        <header class="page-header">
            <h1>Quiz Ταινιών — 10 Τυχαίες Ερωτήσεις</h1>
            <p>Επίλεξε μία από τις 5 απαντήσεις για κάθε ερώτηση. Θα λάβεις άμεση ανατροφοδότηση και στο τέλος το συνολικό σκορ.</p>
        </header>

        <section class="quiz-container" aria-labelledby="quiz-heading">
            <div class="quiz-card" role="application" aria-live="polite">
                <div class="top-row">
                    <div id="progressText" class="progress-text">Ερώτηση 1 / 10</div>
                    <div id="scoreText" class="score-text">Σκορ: 0</div>
                </div>

                <div id="questionArea" class="question-area" aria-atomic="true">
                    <h2 id="questionTitle">Φόρτωση ερώτησης...</h2>
                </div>

                <div id="choices" class="choices" role="listbox" aria-label="Επιλογές"></div>

                <div class="controls">
                    <button id="nextBtn" class="btn primary" disabled aria-disabled="true">Επόμενη Ερώτηση</button>
                    <button id="restartBtn" class="btn ghost" hidden>Ξεκίνα ξανά</button>
                </div>

                <div id="resultSummary" class="result-summary" hidden aria-live="polite"></div>
            </div>
        </section>

        <footer class="footer">
            <div class="container">
                <p>© CineMatch Quiz — Ερωτήσεις με θέμα τις ταινίες.</p>
            </div>
        </footer>
    </main>

<script>
/*
  Quiz behaviour:
  - Επιλέγει τυχαία 10 ερωτήσεις από τη δεξαμενή (θέμα: ταινίες)
  - Κάθε ερώτηση έχει 5 επιλογές
  - Ο χρήστης επιλέγει μια απάντηση, βλέπει αμέσως αν είναι σωστή ή λάθος,
    εμφανίζεται η σωστή απάντηση, και ξεκλειδώνει το "Επόμενη"
  - Στο τέλος εμφανίζεται συνολικό σκορ και πλήρης ανασκόπηση
*/

const POOL = [
    { q: "Ποιος είναι ο σκηνοθέτης της ταινίας 'Inception';", choices: ["Steven Spielberg","Christopher Nolan","Quentin Tarantino","James Cameron","Martin Scorsese"], correct: 1 },
    { q: "Σε ποια ταινία ακούγεται η φράση 'I'll be back';", choices: ["Terminator 2","The Terminator","Predator","RoboCop","Commando"], correct: 1 },
    { q: "Ποιος υποδύεται τον Jack Dawson στην ταινία 'Titanic';", choices: ["Tom Cruise","Leonardo DiCaprio","Brad Pitt","Matt Damon","Johnny Depp"], correct: 1 },
    { q: "Ποια ταινία κέρδισε το Όσκαρ Καλύτερης Ταινίας το 1994;", choices: ["Pulp Fiction","Forrest Gump","The Shawshank Redemption","Four Weddings and a Funeral","Speed"], correct: 1 },
    { q: "Σε ποια σειρά ταινιών εμφανίζεται ο χαρακτήρας Darth Vader;", choices: ["Star Trek","Star Wars","Battlestar Galactica","Guardians of the Galaxy","The Matrix"], correct: 1 },
    { q: "Ποιος σκηνοθέτησε την 'Pulp Fiction';", choices: ["Guy Ritchie","David Fincher","Quentin Tarantino","Ridley Scott","Clint Eastwood"], correct: 2 },
    { q: "Ποια είναι η φανταστική πόλη που είναι το κύριο σκηνικό στην ταινία 'The Dark Knight';", choices: ["Metropolis","Gotham","New York","London","Los Angeles"], correct: 1 },
    { q: "Σε ποια ταινία ακούγεται το τραγούδι 'My Heart Will Go On';", choices: ["Avatar","Titanic","Gladiator","Moulin Rouge!","La La Land"], correct: 1 },
    { q: "Ποιος πρωταγωνίστησε ως Indiana Jones;", choices: ["Sean Connery","Harrison Ford","Tom Hanks","Arnold Schwarzenegger","Mel Gibson"], correct: 1 },
    { q: "Ποια σειρά ταινιών περιλαμβάνει το σχολείο μάγων Hogwarts;", choices: ["The Lord of the Rings","Chronicles of Narnia","Star Wars","Harry Potter","The Hunger Games"], correct: 3 },
    { q: "Ποιος σκηνοθέτησε την ταινία 'E.T. the Extra-Terrestrial';", choices: ["George Lucas","Steven Spielberg","Francis Ford Coppola","Tim Burton","Peter Jackson"], correct: 1 },
    { q: "Ποια ταινία κέρδισε το Όσκαρ Καλύτερης Ταινίας το 2010;", choices: ["The Hurt Locker","Black Swan","Inception","The King's Speech","Toy Story 3"], correct: 3 },
    { q: "Ποια ταινία είναι του Hayao Miyazaki;", choices: ["Spirited Away","Your Name","Akira","Ghost in the Shell","Perfect Blue"], correct: 0 },
    { q: "Ποιος ηθοποιός υποδύθηκε τον Joker στην ταινία 'The Dark Knight' (2008);", choices: ["Joaquin Phoenix","Jared Leto","Heath Ledger","Jack Nicholson","Cillian Murphy"], correct: 2 },
    { q: "Σε ποια ταινία εμφανίζεται ο χαρακτήρας Tyler Durden;", choices: ["Se7en","Fight Club","American Psycho","The Social Network","Gone Girl"], correct: 1 },
    { q: "Ποιος σκηνοθέτησε την τριλογία 'The Lord of the Rings';", choices: ["Peter Jackson","Christopher Nolan","George Lucas","James Cameron","Ridley Scott"], correct: 0 },
    { q: "Ποια ταινία του 1999 είναι γνωστή για την 'κόκκινη' και 'μπλε' επιλογή;", choices: ["The Matrix","Fight Club","The Sixth Sense","Memento","The Blair Witch Project"], correct: 0 },
    { q: "Ποιος πρωταγωνιστεί στην ταινία 'Cast Away' μαζί με έναν κόκκινο τάφο;", choices: ["Tom Hanks","Will Smith","Harrison Ford","Russell Crowe","Kevin Spacey"], correct: 0 },
    { q: "Ποια ταινία του James Cameron διαδραματίζεται σε ένα φανταστικό κόσμο με μπλε αυτόχθονες;", choices: ["Avatar","Terminator","Aliens","True Lies","The Abyss"], correct: 0 },
    { q: "Ποιος υποδύεται τον Neo στην ταινία 'The Matrix';", choices: ["Keanu Reeves","Brad Pitt","Tom Cruise","Matt Damon","Keifer Sutherland"], correct: 0 }
];

// state
let quizQuestions = [];
let currentIndex = 0;
let score = 0;
let answersLog = []; // { q, selectedIndex, correctIndex, choices }

const progressText = document.getElementById('progressText');
const scoreText = document.getElementById('scoreText');
const questionTitle = document.getElementById('questionTitle');
const choicesEl = document.getElementById('choices');
const nextBtn = document.getElementById('nextBtn');
const restartBtn = document.getElementById('restartBtn');
const resultSummary = document.getElementById('resultSummary');

function shuffleArray(a) {
    for (let i = a.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [a[i], a[j]] = [a[j], a[i]];
    }
    return a;
}

function pickQuestions() {
    const poolCopy = POOL.map((p,i) => ({...p, id:i}));
    shuffleArray(poolCopy);
    return poolCopy.slice(0, 10).map(q => {
        const choices = q.choices.map((c, idx) => ({ text: c, originalIndex: idx }));
        shuffleArray(choices);
        const newCorrectIndex = choices.findIndex(c => c.originalIndex === q.correct);
        return {
            q: q.q,
            choices: choices.map(c => c.text),
            correct: newCorrectIndex
        };
    });
}

function renderQuestion() {
    const item = quizQuestions[currentIndex];
    progressText.textContent = `Ερώτηση ${currentIndex + 1} / ${quizQuestions.length}`;
    scoreText.textContent = `Σκορ: ${score}`;
    questionTitle.textContent = item.q;

    choicesEl.innerHTML = '';
    choicesEl.dataset.answered = 'false';
    item.choices.forEach((choice, i) => {
        const btn = document.createElement('button');
        btn.className = 'choice-btn';
        btn.type = 'button';
        btn.setAttribute('data-index', i);
        btn.setAttribute('role', 'option');
        btn.textContent = choice;
        btn.addEventListener('click', onChoiceClick);
        btn.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' || e.key === ' ') {
                e.preventDefault();
                btn.click();
            }
        });
        choicesEl.appendChild(btn);
    });

    nextBtn.disabled = true;
    nextBtn.setAttribute('aria-disabled', 'true');
    nextBtn.hidden = false;
    restartBtn.hidden = true;
    resultSummary.hidden = true;
}

function onChoiceClick(e) {
    const selected = Number(e.currentTarget.getAttribute('data-index'));
    const item = quizQuestions[currentIndex];
    if (choicesEl.dataset.answered === 'true') return;
    choicesEl.dataset.answered = 'true';

    const buttons = Array.from(choicesEl.querySelectorAll('.choice-btn'));
    buttons.forEach((b, idx) => {
        b.disabled = true;
        b.classList.remove('chosen-correct', 'chosen-wrong');
        if (idx === item.correct) b.classList.add('correct');
    });

    const selectedBtn = e.currentTarget;
    let correctNow = false;
    if (selected === item.correct) {
        selectedBtn.classList.add('chosen-correct');
        score++;
        correctNow = true;
        scoreText.textContent = `Σκορ: ${score}`;
    } else {
        selectedBtn.classList.add('chosen-wrong');
    }

    answersLog.push({
        q: item.q,
        selectedIndex: selected,
        correctIndex: item.correct,
        choices: item.choices.slice()
    });

    const feedback = document.createElement('div');
    feedback.className = 'feedback';
    feedback.textContent = correctNow ? 'Σωστό!' : 'Λάθος!';
    choicesEl.appendChild(feedback);

    nextBtn.disabled = false;
    nextBtn.setAttribute('aria-disabled', 'false');
}

nextBtn.addEventListener('click', () => {
    currentIndex++;
    if (currentIndex < quizQuestions.length) {
        renderQuestion();
        window.scrollTo({ top: 0, behavior: 'smooth' });
    } else {
        showSummary();
    }
});

restartBtn.addEventListener('click', () => startQuiz());

function showSummary() {
    progressText.textContent = `Ολοκληρώθηκε`;
    questionTitle.textContent = `Τελικό σκορ: ${score} / ${quizQuestions.length}`;
    choicesEl.innerHTML = '';
    nextBtn.hidden = true;
    restartBtn.hidden = false;
    resultSummary.hidden = false;

    let html = `<h3>Αποτελέσματα</h3>`;
    html += `<p>Σύνολο σωστών: <strong>${score}</strong> από ${quizQuestions.length}</p>`;
    html += `<div class="review">`;
    answersLog.forEach((a, i) => {
        const correctText = a.choices[a.correctIndex] ?? '';
        const selectedText = a.choices[a.selectedIndex] ?? '';
        const ok = a.selectedIndex === a.correctIndex;
        html += `<div class="review-item">
                    <div class="r-q"><strong>Q${i+1}:</strong> ${escapeHtml(a.q)}</div>
                    <div class="r-ans ${ok ? 'ok' : 'bad'}">
                        <div>Η δική σου απάντηση: <span class="user">${escapeHtml(selectedText)}</span></div>
                        <div>Σωστή απάντηση: <span class="correct">${escapeHtml(correctText)}</span></div>
                    </div>
                 </div>`;
    });
    html += `</div>`;
    resultSummary.innerHTML = html;
    window.scrollTo({ top: 0, behavior: 'smooth' });
}

function startQuiz() {
    quizQuestions = pickQuestions();
    currentIndex = 0;
    score = 0;
    answersLog = [];
    renderQuestion();
}

// safety helper
function escapeHtml(unsafe) {
    if (!unsafe && unsafe !== '') return '';
    return String(unsafe)
        .replace(/&/g, '&amp;')
        .replace(/</g, '&lt;')
        .replace(/>/g, '&gt;')
        .replace(/"/g, '&quot;')
        .replace(/'/g, '&#039;');
}

startQuiz();
</script>
</body>
</html>
